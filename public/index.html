<!DOCTYPE html>
<html>
  <head>
    <title>Log Plotter</title>

    <link rel="icon" type="image/x-icon" href="/public/favicon.ico">
    <link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <link rel="stylesheet" href="public/styles.css">

    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="public/components/loading-spinner.js" defer></script>
    <script src="public/components/chart-controls.js" defer></script>
    <script src="public/components/time-chart.js" defer></script>
  </head>

  <body>
    <chart-controls></chart-controls>
    <loading-spinner id="spinner"></loading-spinner>
    <time-chart></time-chart>
  </body>

  <script>
    'use strict'

    window.addEventListener('load', e => {
      const loadingSpinner = document.querySelector('loading-spinner')
      const chartControls = document.querySelector('chart-controls')
      const chart = document.querySelector('time-chart')

      chartControls.addEventListener('request-reset', e => chart.reset())

      chart.addEventListener('chart-updated', e =>
        chartControls.updateRangeLabels(e.detail))

      chart.addEventListener('point-clicked', e =>
        console.info(e.detail.item) && Toastify({
          text: 'Log event logged in console',
          className: 'toast-info'
        }).showToast()
      )

      chart.addEventListener('xhr-started', e => loadingSpinner.show())
      chart.addEventListener('xhr-ended', e => loadingSpinner.hide())
      chart.addEventListener('xhr-error', e =>
        Toastify({
          text: e.detail.err,
          className: 'toast-error'
        }).showToast()
      )

      chart.create().init()
    })
  </script>
</html>
